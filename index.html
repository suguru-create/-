<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="営業リスト管理アプリケーション - 営業先の情報を効率的に管理">
    <title>営業リスト管理</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1 class="app-title">
                    <span class="title-icon">📊</span>
                    営業リスト管理
                </h1>
                <div class="header-actions">
                    <button id="searchPlacesBtn" class="btn btn-secondary">
                        <span class="btn-icon">🔍</span>
                        企業検索
                    </button>
                    <button id="importBtn" class="btn btn-secondary">
                        <span class="btn-icon">📤</span>
                        インポート
                    </button>
                    <button id="exportBtn" class="btn btn-secondary">
                        <span class="btn-icon">📥</span>
                        エクスポート
                    </button>
                    <button id="addBtn" class="btn btn-primary">
                        <span class="btn-icon">➕</span>
                        新規追加
                    </button>
                </div>
            </div>
        </header>

        <!-- Hidden file input for CSV import -->
        <input type="file" id="csvFileInput" accept=".csv" style="display: none;">

        <!-- Controls -->
        <div class="controls-section">
            <div class="search-container">
                <span class="search-icon">🔍</span>
                <input type="text" id="searchInput" class="search-input" placeholder="会社名、担当者名、業種で検索...">
            </div>

            <div class="filters-container">
                <div class="filter-group">
                    <label class="filter-label">ステータス:</label>
                    <select id="statusFilter" class="filter-select">
                        <option value="">すべて</option>
                        <option value="未接触">未接触</option>
                        <option value="商談中">商談中</option>
                        <option value="成約">成約</option>
                        <option value="失注">失注</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">業種:</label>
                    <select id="industryFilter" class="filter-select">
                        <option value="">すべて</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">見込み度:</label>
                    <select id="prospectFilter" class="filter-select">
                        <option value="">すべて</option>
                        <option value="脈あり">🟢 脈あり</option>
                        <option value="要フォロー">🟡 要フォロー</option>
                        <option value="脈なし">🔴 脈なし</option>
                        <option value="未評価">⚪ 未評価</option>
                    </select>
                </div>

                <button id="clearFiltersBtn" class="btn btn-text">
                    フィルタークリア
                </button>
            </div>

            <!-- View Mode Selector -->
            <div class="view-mode-selector">
                <button class="view-mode-btn active" data-view="table">
                    <span class="view-icon">📋</span>
                    標準ビュー
                </button>
                <button class="view-mode-btn" data-view="date">
                    <span class="view-icon">📅</span>
                    訪問日別
                </button>
                <button class="view-mode-btn" data-view="genre">
                    <span class="view-icon">🏢</span>
                    ジャンル別
                </button>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-value" id="totalCount">0</div>
                <div class="stat-label">総件数</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="untouchedCount">0</div>
                <div class="stat-label">未接触</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="negotiatingCount">0</div>
                <div class="stat-label">商談中</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="closedCount">0</div>
                <div class="stat-label">成約</div>
            </div>
            <div class="stat-card stat-card-prospect">
                <div class="stat-value" id="hotProspectCount">0</div>
                <div class="stat-label">🟢 脈あり</div>
            </div>
            <div class="stat-card stat-card-prospect">
                <div class="stat-value" id="followUpCount">0</div>
                <div class="stat-label">🟡 要フォロー</div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Table View -->
            <div class="table-container" id="tableView">
                <table class="data-table" id="dataTable">
                    <thead>
                        <tr>
                            <th class="sortable" data-column="companyName">
                                会社名 <span class="sort-indicator"></span>
                            </th>
                            <th class="sortable" data-column="contactPerson">
                                担当者名 <span class="sort-indicator"></span>
                            </th>
                            <th class="sortable" data-column="industry">
                                業種 <span class="sort-indicator"></span>
                            </th>
                            <th class="sortable" data-column="status">
                                ステータス <span class="sort-indicator"></span>
                            </th>
                            <th class="sortable" data-column="prospectLevel">
                                見込み度 <span class="sort-indicator"></span>
                            </th>
                            <th class="sortable" data-column="lastContact">
                                最終接触日 <span class="sort-indicator"></span>
                            </th>
                            <th>アクション</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Data rows will be inserted here -->
                    </tbody>
                </table>

                <div id="emptyState" class="empty-state">
                    <div class="empty-icon">📋</div>
                    <h3>営業先がまだ登録されていません</h3>
                    <p>「新規追加」ボタンから営業先を登録してください</p>
                </div>
            </div>

            <!-- Grouped View -->
            <div id="groupedView" class="grouped-view" style="display: none;">
                <!-- Groups will be inserted here dynamically -->
            </div>
        </main>

        <!-- Modal -->
        <div id="modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle">新規営業先追加</h2>
                    <button class="modal-close" id="closeModal">&times;</button>
                </div>

                <form id="salesForm" class="sales-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="companyName">会社名 <span class="required">*</span></label>
                            <input type="text" id="companyName" name="companyName" required>
                        </div>

                        <div class="form-group">
                            <label for="contactPerson">担当者名 <span class="required">*</span></label>
                            <input type="text" id="contactPerson" name="contactPerson" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="phone">電話番号</label>
                            <input type="tel" id="phone" name="phone">
                        </div>

                        <div class="form-group">
                            <label for="email">メールアドレス</label>
                            <input type="email" id="email" name="email">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="address">住所</label>
                        <input type="text" id="address" name="address">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="industry">業種 <span class="required">*</span></label>
                            <input type="text" id="industry" name="industry" required>
                        </div>

                        <div class="form-group">
                            <label for="status">ステータス <span class="required">*</span></label>
                            <select id="status" name="status" required>
                                <option value="未接触">未接触</option>
                                <option value="商談中">商談中</option>
                                <option value="成約">成約</option>
                                <option value="失注">失注</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="prospectLevel">見込み度 <span class="required">*</span></label>
                        <select id="prospectLevel" name="prospectLevel" required>
                            <option value="未評価">⚪ 未評価</option>
                            <option value="脈あり">🟢 脈あり</option>
                            <option value="要フォロー">🟡 要フォロー</option>
                            <option value="脈なし">🔴 脈なし</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="lastContact">最終接触日</label>
                        <input type="date" id="lastContact" name="lastContact">
                    </div>

                    <div class="form-group">
                        <label for="notes">メモ</label>
                        <textarea id="notes" name="notes" rows="4"></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelBtn">
                            キャンセル
                        </button>
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            保存
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div id="deleteModal" class="modal">
            <div class="modal-content modal-small">
                <div class="modal-header">
                    <h2>削除確認</h2>
                    <button class="modal-close" id="closeDeleteModal">&times;</button>
                </div>

                <div class="modal-body">
                    <p>この営業先を削除してもよろしいですか？</p>
                    <p class="delete-warning">この操作は取り消せません。</p>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelDeleteBtn">
                        キャンセル
                    </button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                        削除
                    </button>
                </div>
            </div>
        </div>

        <!-- Search Places Modal -->
        <div id="searchModal" class="modal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2>企業検索（Google Places API）</h2>
                    <button class="modal-close" id="closeSearchModal">&times;</button>
                </div>

                <div class="modal-body">
                    <!-- API Key Warning -->
                    <div id="apiKeyWarning" class="api-warning" style="display: none;">
                        <span class="warning-icon">⚠️</span>
                        <span>APIキーが設定されていません。<a href="#" id="openSettingsFromWarning">設定画面</a>でAPIキーを入力してください。</span>
                    </div>

                    <!-- Search Form -->
                    <form id="searchPlacesForm" class="search-places-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="searchLocation">エリア <span class="required">*</span></label>
                                <input type="text" id="searchLocation" placeholder="例: 渋谷、新宿、東京" required>
                                <small class="form-hint">検索したいエリアを入力してください</small>
                            </div>

                            <div class="form-group">
                                <label for="searchKeyword">業種・キーワード <span class="required">*</span></label>
                                <input type="text" id="searchKeyword" placeholder="例: 美容院、飲食店、IT企業" required>
                                <small class="form-hint">業種や検索キーワードを入力してください</small>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" id="executeSearchBtn">
                                <span class="btn-icon">🔍</span>
                                検索
                            </button>
                        </div>
                    </form>

                    <!-- Loading State -->
                    <div id="searchLoading" class="search-loading" style="display: none;">
                        <div class="loading-spinner"></div>
                        <p>検索中...</p>
                    </div>

                    <!-- Search Results -->
                    <div id="searchResults" class="search-results" style="display: none;">
                        <div class="results-header">
                            <h3>検索結果 (<span id="resultsCount">0</span>件)</h3>
                            <button type="button" class="btn btn-primary" id="addSelectedBtn" disabled>
                                <span class="btn-icon">➕</span>
                                選択した企業を追加 (<span id="selectedCount">0</span>)
                            </button>
                        </div>

                        <div id="resultsList" class="results-list">
                            <!-- Results will be inserted here -->
                        </div>
                    </div>

                    <!-- No Results -->
                    <div id="noResults" class="no-results" style="display: none;">
                        <div class="empty-icon">🔍</div>
                        <h3>検索結果が見つかりませんでした</h3>
                        <p>検索条件を変更してもう一度お試しください</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>設定</h2>
                    <button class="modal-close" id="closeSettingsModal">&times;</button>
                </div>

                <div class="modal-body">
                    <div class="settings-section">
                        <h3>Google Places API</h3>

                        <div class="form-group">
                            <label for="apiKeyInput">APIキー</label>
                            <input type="password" id="apiKeyInput" placeholder="Google Places APIキーを入力">
                            <small class="form-hint">
                                APIキーの取得方法は<a href="#" id="openApiGuide">セットアップガイド</a>をご覧ください
                            </small>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="testApiKeyBtn">
                                接続テスト
                            </button>
                            <button type="button" class="btn btn-primary" id="saveApiKeyBtn">
                                保存
                            </button>
                        </div>

                        <div id="apiKeyStatus" class="api-status" style="display: none;"></div>
                    </div>

                    <div class="settings-section">
                        <h3>使用量</h3>
                        <div class="usage-stats">
                            <div class="usage-item">
                                <span class="usage-label">今月の検索回数:</span>
                                <span class="usage-value" id="monthlySearchCount">0</span>
                            </div>
                            <div class="usage-item">
                                <span class="usage-label">推定コスト:</span>
                                <span class="usage-value" id="estimatedCost">$0.00</span>
                            </div>
                            <div class="usage-item">
                                <span class="usage-label">無料枠残り:</span>
                                <span class="usage-value" id="freeQuotaRemaining">$200.00</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="places-api.js"></script>
    <script src="app.js"></script>
    <script src="view-mode.js"></script>
</body>

</html>